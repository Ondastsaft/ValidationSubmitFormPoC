@page "/"
@inject             CompanyService CompanyService
@    using formtest.Models
@rendermode InteractiveServer

<div style="display: flex; justify-content: flex-end; width: 100%;">
    <div style="max-width: 300px; margin-right: 20px;">
        <label for="companySelect">Välj Företag</label>
        <select @onchange="@(e => EnableEmployeeSelection(e.Value))">
            <option value="">Välj ett företag</option>
            @foreach (var company in companies)
            {
                <option value="@company.Id">@company.Name</option>
            }
        </select>
    </div>

    <div style="max-width: 300px; margin-right: 20px;">
        <label for="employeeSelect">Välj Anställd</label>
        <select disabled="@isEmployeeListDisabled">
            <option value="">Välj en anställd</option>
            @foreach (var employee in employees)
            {
                @if (employee.CompanyId == selectedCompanyId)
                {
                    <option value="@employee.Id">@employee.FirstName @employee.LastName</option>
                }
            }
        </select>
    </div>
</div>

@code {
    private List<Company> companies = new();
    private List<Employee> employees = new();
    private int? selectedCompanyId;
    private bool isEmployeeListDisabled = true;

    protected override void OnInitialized()
    {
        companies = CompanyService.GetCompanies();
        employees = CompanyService.GetEmployees();
    }

    private void EnableEmployeeSelection(object selectedValue)
    {
        if (int.TryParse(selectedValue.ToString(), out int companyId))
        {
            selectedCompanyId = companyId;
            if (selectedCompanyId > 0)
            {
                isEmployeeListDisabled = false;
                Console.WriteLine("Ett företag har valts. Anställd-listan är nu aktiverad.");
            }
            else
            {
                isEmployeeListDisabled = true;
                Console.WriteLine("Inget företag valt.");
            }
        }
        StateHasChanged();
    }
}
